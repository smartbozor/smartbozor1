document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector("#id-ajax-modal");new bootstrap.Modal(t);const a=t.querySelector(".modal-body");let n=void 0;const d=new Intl.NumberFormat("uz",{style:"currency",currency:"UZS",maximumFractionDigits:0});function o(e){t.querySelector(".modal-header span").innerText=e}t.addEventListener("show.bs.modal",e=>{n=parseInt(e.relatedTarget.dataset.pk)||void 0,o("Loading..."),a.innerHTML='<div class="text-center p-4"><div class="spinner-border"></div></div>',fetch(e.relatedTarget.dataset.url,{method:"PATCH",headers:csrf_header()}).then(e=>e.json()).then(n=>{o(n.title);let r='<table class="table table-striped table-hover align-middle">',e=1;n.headers&&(e=n.headers.length,r+='<thead><tr class="table-dark">',n.headers.forEach(e=>{r+=`<td>${e}</td>`}),n.editable&&(r+='<td style="width: 1%"></td>'),r+="</tr></thead>"),n.data&&(r+="<tbody>",n.data.forEach((e,t)=>{var a;r+="<tr>",e.forEach(e=>{r+=`<td>${e}</td>`}),n.editable&&([e,t,a]=n.editable[t],r+=a?`<td class="cursor-pointer" data-id="${e}" data-amount="${t}"><span class="bi bi-pencil"></span></td>`:"<td></td>"),r+="</tr>"}),0===n.data.length&&(r+=`<tr><td colspan="${e}">${gettext("Ma'lumot topilmadi")}</td>`),r+="</tbody>"),r+="</table>",a.innerHTML=r,a.querySelectorAll("td[data-id]").forEach(n=>{n._html=n.innerHTML,n.addEventListener("click",function(e){if(n.querySelector("input"))e.preventDefault();else{n.innerHTML='<div class="input-group flex-nowrap"><input name="a" class="form-control py-1" style="width: 150px"/><button type="button" class="btn btn-primary btn-sm px-3 py-1"><span class="bi bi-floppy"></span></button></div>';const t=n.querySelector("input"),a=n.querySelector("button");t.value=n.dataset.amount,a.addEventListener("click",function(){t.disabled=!0,a.disabled=!0,a.querySelector("span").classList.remove("bi","bi-floppy"),a.querySelector("span").classList.add("spinner-border","spinner-border-sm"),n.dataset.amount=t.value,fetch("",{method:"PUT",headers:csrf_header(),body:JSON.stringify({id:n.dataset.id,amount:parseInt(t.value)||0})}).then(e=>e.json()).then(e=>{e.success?(n.innerHTML=n._html,n.closest("td").previousElementSibling.innerHTML=d.format(t.value)):alert(e.error)}).catch(e=>{alert(e.toString())})})}})})}).catch(e=>alert(e))}),t.addEventListener("hidden.bs.modal",function(e){var t;n?((t=new URL(window.location.href)).searchParams.set("hl",n),window.location.href=t.toString()):window.location.reload()})});